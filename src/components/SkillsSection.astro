---
// Import images from skills directory
import { Image } from 'astro:assets';

// Replace Astro.glob with import.meta.glob
const skillImagesModules = import.meta.glob('../assets/skills/*', { eager: true });
const skillImages = Object.values(skillImagesModules);
---

<section class="skills-section" id="skills">
  <div class="container">
    <div class="skills-container">
      <div class="skills-nav desktop-only">
        <div class="nav-items">
          <div class="nav-item active" data-index="0">01</div>
          <div class="nav-item" data-index="1">02</div>
          <div class="nav-item" data-index="2">03</div>
          <div class="nav-item" data-index="3">04</div>
        </div>
      </div>
      
      <div class="skills-content">
        <div class="skill-items">
          <div class="skill-item" data-index="0">
            <div class="skill-image">
              <Image 
                src={skillImages[0]?.default} 
                alt="Skill 1" 
                width={450} 
                height={450} 
              />
            </div>
            <div class="skill-text">
              <h3>UX/UI Design</h3>
              <p>Je conçois des interfaces intuitives et esthétiques qui captivent vos utilisateurs et boostent vos conversions. En combinant recherche utilisateur, wireframes et prototypage interactif, je crée des expériences fluides et optimisées pour l'engagement, tout en respectant votre identité visuelle. Un design centré sur l'humain, mais aussi sur vos objectifs business.</p>
            </div>
          </div>
          
          <div class="skill-item" data-index="1">
            <div class="skill-image">
              <Image 
                src={skillImages[2]?.default} 
                alt="Skill 2" 
                width={450} 
                height={450} 
              />
            </div>
            <div class="skill-text">
              <h3>Programmation Web</h3>
              <p>Des sites rapides, légers et sur-mesure grâce à ma maîtrise d'HTML/CSS/JS, d'Astro et de React. Je développe des interfaces dynamiques, SEO-friendly et parfaitement responsives, tout en garantissant un code propre et maintenable. Des solutions techniques modernes pour des performances qui font la différence.</p>
            </div>
          </div>
          
          <div class="skill-item" data-index="2">
            <div class="skill-image">
              <Image 
                src={skillImages[3]?.default} 
                alt="Skill 3" 
                width={450} 
                height={450} 
              />
            </div>
            <div class="skill-text">
              <h3>CMS</h3>
              <p>Vous voulez un site simple à gérer, sans compromis sur le design ? Je crée des sites WordPress personnalisés, optimisés pour le référencement et adaptés à tous écrans. Des solutions clé en main, livrées rapidement, avec une interface admin intuitive pour modifier votre contenu en toute autonomie.</p>
            </div>
          </div>
          
          <div class="skill-item" data-index="3">
            <div class="skill-image">
              <Image 
                src={skillImages[1]?.default} 
                alt="Skill 4" 
                width={450} 
                height={450} 
              />
            </div>
            <div class="skill-text">
              <h3>Sécurité site web</h3>
              <p>Votre réputation mérite une sécurité sans concession. Je déploie des mesures proactives pour protéger votre site : chiffrement SSL, audits réguliers, mises à jour critiques et sauvegardes automatisées. En sécurisant chaque interaction (formulaires, connexions, paiements), je réduis les risques tout en renforçant la confiance de vos visiteurs. Transparence et réactivité face aux menaces font de votre sécurité un argument crédible, pas une promesse vide. Convertissez avec sérénité, en montrant que la protection de leurs données est votre priorité.</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<style>
  .skills-section {
    width: 100%;
    background-color: #fff;
    position: relative;
    padding: 200px 0;
    min-height: 100vh;
  }
  
  .container {
    max-width: 1200px;
    margin: 0 auto;
    width: 100%;
    padding: 0 100px;
  }
  
  .skills-container {
    display: flex;
    gap: 4rem;
    width: 100%;
  }
  
  .skills-nav {
    position: sticky;
    top: 50%;
    transform: translateY(-50%);
    height: fit-content;
    align-self: flex-start;
  }
  
  .nav-items {
    display: flex;
    flex-direction: column;
    gap: 2rem;
  }
  
  .nav-item {
    font-size: 2rem;
    font-weight: 500;
    color: #999;
    position: relative;
    padding-left: 20px;
  }
  
  .nav-item.active {
    color: #DB241E;
    font-weight: 600;
  }
  
  .nav-item.active::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    height: 100%;
    width: 4px;
    background-color: #DB241E;
  }
  
  .skills-content {
    flex: 1;
  }
  
  .skill-items {
    position: relative;
  }
  
  .skill-item {
    display: flex;
    align-items: center;
    gap: 4rem;
    min-height: 80vh;
    opacity: 0;
    transition: opacity 0.2s ease; /* Uniquement transition d'opacité */
    position: relative;
  }
  
  .skill-item.active {
    opacity: 1;
  }
  
  .skill-item.inactive {
    opacity: 0;
  }
  
  .skill-image {
    width: 450px;
    height: 450px;
    border-radius: 12px;
    overflow: hidden;
    background-color: #f5f5f5;
  }
  
  .skill-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
  
  .skill-text {
    flex: 1;
  }
  
  .skill-text h3 {
    font-size: 3rem;
    font-weight: 600;
    color: #0A1B40;
    margin-bottom: 2rem;
  }
  
  .skill-text p {
    font-size: 1.2em;
    line-height: 1.8;
    color: #666;
  }

  @media (max-width: 768px) {
    .skills-section {
      padding: 60px 0;
      min-height: auto;
    }

    .container {
      padding: 0 20px;
    }
    
    .skills-container {
      flex-direction: column;
      gap: 2rem;
    }
    
    .desktop-only {
      display: none;
    }
    
    .skill-item {
      flex-direction: column;
      gap: 2rem;
      min-height: auto;
      padding: 2rem 0;
      opacity: 1 !important;
      transform: none !important;
      transition: none !important;
      margin-bottom: 4rem; /* Augmentation de l'espace entre les sections */
    }
    
    .skill-image {
      width: 100%;
      height: 200px; /* Réduction de la hauteur des images sur mobile */
    }
    
    .skill-text h3 {
      font-size: 2rem;
      text-align: left; /* Alignement à gauche */
    }

    .skill-text p {
      font-size: 1.1em;
      text-align: left; /* Alignement à gauche */
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const isMobile = window.innerWidth <= 768;
    
    if (isMobile) {
      // Simple mobile behavior - show all items
      const skillItems = document.querySelectorAll('.skill-item');
      skillItems.forEach(item => {
        item.classList.add('active');
      });
    } else {
      // Desktop behavior with ScrollMagic
      import('scrollmagic').then((ScrollMagic) => {
        const controller = new ScrollMagic.Controller();
        
        const skillItems = document.querySelectorAll('.skill-item');
        const navItems = document.querySelectorAll('.nav-item');
        
        // Make first item visible immediately
        skillItems[0].classList.add('active');
        
        // Utiliser la section entière comme déclencheur
        const skillsSection = document.querySelector('.skills-section');
        
        // Définir des points de déclenchement plus rapprochés pour une meilleure distribution
        const triggerPoints = [0, 0.25, 0.45, 0.65]; // Points de déclenchement ajustés
        
        // Créer une scène pour chaque élément de compétence
        skillItems.forEach((item, index) => {
          const scene = new ScrollMagic.Scene({
            triggerElement: skillsSection,
            triggerHook: 0.2,
            offset: triggerPoints[index] * skillsSection.offsetHeight,
            duration: '20%'
          })
          .on('enter', () => {
            // Activer l'élément actuel avec une légère animation de fade-in uniquement
            item.style.transition = "opacity 0.5s ease";
            item.classList.add('active');
            item.classList.remove('inactive');
            
            // Mettre à jour la navigation
            navItems.forEach(nav => nav.classList.remove('active'));
            navItems[index].classList.add('active');
            
            // Désactiver les autres éléments avec une légère animation de fade-out
            skillItems.forEach((otherItem, otherIndex) => {
              if (otherIndex !== index) {
                otherItem.style.transition = "opacity 0.15s ease";
                otherItem.classList.remove('active');
                otherItem.classList.add('inactive');
              }
            });
          })
          .addTo(controller);
        });
        
      }).catch(err => {
        console.error('Failed to load ScrollMagic:', err);
        
        // Fallback behavior
        const skillItems = document.querySelectorAll('.skill-item');
        const navItems = document.querySelectorAll('.nav-item');
        
        // Make all items visible without animation
        skillItems.forEach(item => {
          item.classList.add('active');
        });
      });
    }
  });
</script>